# 臨床心理学AIカウンセラー - Claude Code引き継ぎメモ

## 概要

namisapo.app用のRAGナレッジベースと、それを活用するAIカウンセラーのシステムプロンプトです。
田所先生の臨床心理学講義（全16本）を階層的RAG（SINR手法）で構造化しています。

---

## ファイル構成

```
clinical_psych_rag_SINR_hierarchical.zip
├── parents/                    # 親チャンク（135個）
│   ├── lecture01/             # 講義1: 臨床心理学概論
│   │   ├── 01-01_parent.md
│   │   ├── 01-02_parent.md
│   │   └── ...
│   ├── lecture02/             # 講義2: 心理療法の学派
│   └── lecture03-16/          # 講義3-16
├── children/                   # 子チャンク（523個）
│   ├── lecture01/
│   │   ├── 01-01-01_child.md
│   │   ├── 01-01-02_child.md
│   │   └── ...
│   └── ...
├── mapping.json               # 親子関係マッピング
└── README.md                  # 使い方説明

clinical_psych_system_prompt.md  # AIカウンセラー用システムプロンプト
```

---

## SINR手法とは

**Small-to-big Information Retrieval**の略。検索精度と文脈保持を両立する階層的RAG手法。

### 仕組み

1. **子チャンク（small）**: 短く具体的（平均286文字）→ ベクトル検索の精度が高い
2. **親チャンク（big）**: 文脈を保持（800-1200文字）→ LLMが回答生成に使用

### 検索フロー

```
ユーザー質問
    ↓
子チャンクでベクトル検索（Embeddingで類似度計算）
    ↓
ヒットした子の parent_id を取得
    ↓
対応する親チャンクをLLMに渡す
    ↓
回答生成
```

---

## チャンク構造

### 親チャンク例

```markdown
---
lecture_series: 臨床心理学
lecture_number: 1
chunk_id: "01-03"
title: 科学者-実践家モデル
category: 臨床心理学基礎
keywords: [科学者-実践家モデル, 研究, 実践, 統合]
source: 田所先生臨床心理学講義
related_concepts: [エビデンスベースド実践, 効果研究]
---

# 科学者-実践家モデル

臨床心理学では「科学者-実践家モデル」が重要視されています...
（800-1200文字）
```

### 子チャンク例

```markdown
---
parent_id: "01-03"
child_id: "01-03-01"
title: 科学者-実践家モデルの定義
keywords: [科学者-実践家モデル, 研究と実践の統合]
---

科学者-実践家モデルとは、臨床心理学者が研究者としての視点と実践者としての技能を統合するアプローチです。
（約200-400文字）
```

---

## 実装方法

### 1. Dify/Flowise等のノーコードツールの場合

1. `children/` フォルダをベクトルDBにインポート
2. `parents/` フォルダを別のナレッジベースとして登録
3. 検索時に子→親の参照ロジックを構築

### 2. LangChain/LlamaIndexの場合

```python
# 検索ロジック例
def retrieve_with_sinr(query: str, k: int = 3):
    # 1. 子チャンクで検索
    child_results = vector_store.similarity_search(query, k=k)
    
    # 2. 親IDを収集
    parent_ids = set()
    for child in child_results:
        parent_ids.add(child.metadata['parent_id'])
    
    # 3. 親チャンクを取得
    parent_chunks = []
    for pid in parent_ids:
        parent = parent_store.get(pid)
        parent_chunks.append(parent)
    
    return parent_chunks
```

### 3. GPTs/カスタムGPTの場合

- `children/` と `parents/` を両方アップロード
- システムプロンプトで検索→参照のフローを指示
- 実際の検索はOpenAIのRetrieval機能が自動処理

---

## システムプロンプトの使い方

### 組み込み方法

1. `clinical_psych_system_prompt.md` の内容をそのままシステムプロンプトに設定
2. RAGナレッジベースと連携させる
3. 必要に応じてカスタマイズ

### カスタマイズポイント

- **サービス名**: 「namisapo」などに変更
- **安全性条項**: 法的要件に合わせて調整
- **対応範囲**: 特定の症状・悩みに限定する場合は明記
- **免責事項**: サービスの法的要件に合わせて追加

---

## 講義内容一覧

| 講義 | タイトル | 親チャンク数 | 主要トピック |
|------|----------|--------------|--------------|
| 01 | 臨床心理学概論 | 10 | 定義、歴史、科学者-実践家モデル |
| 02 | 心理療法の学派 | 10 | 精神力動、CBT、人間性、システミック |
| 03 | 臨床心理学概論（大規模） | 14 | 5大ネガティブ、介入、見立て |
| 04 | セルフコンパッション | 8 | 3要素、実践法、効果 |
| 05 | 人目を気にする心理 | 11 | 愛着理論、自尊心、対処法 |
| 06 | パニック障害の克服 | 16 | メカニズム、曝露療法、予期不安 |
| 07 | 罪悪感を手放す | 5 | 適切/不適切な罪悪感、対処3ステップ |
| 08 | 問題解決の進め方 | 5 | 4ステップ、ブレインストーミング |
| 09 | 臨床心理学とは何か | 5 | 定義、目的、方法 |
| 10 | 心理学とは何か | 5 | 歴史、分野、アプローチ |
| 11 | 強迫性障害 | 8 | OCD、ERP、巻き込み |
| 12 | 大人の発達障害 | 5 | ASD、ADHD、グレーゾーン |
| 13 | 中高年の心の健康 | 6 | 中年の危機、本音、老年期 |
| 14 | クライエント中心療法 | 5 | ロジャーズ、3条件、自己一致 |
| 15 | 臨床心理士と公認心理師 | 5 | 深める/広げる、多職種連携 |
| 16 | 認知行動療法 | 13 | 認知の歪み10種類、認知再構成法 |

---

## 注意事項

### データの取り扱い

- 田所先生の講義を元にしているため、商用利用時は権利確認が必要
- YouTube運営に関する内容（チャンネル登録促進等）は除外済み
- 個人名（受講者名等）は除外済み

### 更新方法

1. 新しい講義が追加された場合:
   - 同じフォーマットで親チャンクを作成
   - 子チャンクに分割
   - mapping.jsonを更新

2. 内容を修正する場合:
   - 該当する親/子チャンクを直接編集
   - YAMLフロントマターは維持

---

## トラブルシューティング

### 検索精度が低い場合

1. 子チャンクのkeywordsを見直す
2. 子チャンクをさらに細分化（200文字以下）
3. 類似概念を統合

### 回答が浅い場合

1. 親チャンクの情報量を増やす
2. 関連する複数の親チャンクを取得するよう調整
3. システムプロンプトで詳細な回答を促す

---

## 連絡先

このナレッジベースに関する質問は、作成時のClaudeチャット履歴を参照してください。

- 作成日: 2026年1月4日
- 作成者: Claude（Anthropic）+ 仁さん
